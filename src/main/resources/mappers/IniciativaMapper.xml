<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="edu.eci.cvds.persistence.mybatisimpl.mappers.IniciativaMapper">

    <resultMap type='Iniciativa' id='IniciativaResult'>
        <result property='nombrePropuesta' column='nombrePropuesta'/>  
		<result property='descripcion' column='descripcion'/>
		<result property='fechaInicio' column='fechaInicio'/>
		<result property='area' column='area'/>
		<result property='usuario' column='usuario'/>
		<result property='estado_Propuesta' column='estado_Propuesta'/> 
    </resultMap>  

	<select id="consultarTodasLasPropuestas" resultMap="IniciativaResult" parameterType="map">
		SELECT 
	    i.nombrePropuesta,
		i.descripcion,
		i.fechaInicio,
		i.area,
		i.usuario,
		i.estado_Propuesta,
		u.nombre
		FROM iniciativa as i
		JOIN usuario as u
		ON i.usuario = u.correo;
    </select>
	
	<insert id="insertarIniciativa" parameterType="Iniciativa">
		INSERT INTO Iniciativa (nombrePropuesta, descripcion, fechaInicio, area, usuario, estado_Propuesta) 
		VALUES(#{nombrePropuesta}, #{descripcion}, #{fechaInicio}, #{area}, #{usuario}, #{estadoPropuesta});
	</insert>
	
	<select id="consultarPropuestaPorUsuario" resultMap="IniciativaResult" parameterType="map">
		SELECT 
	    i.nombrePropuesta,
		i.descripcion,
		i.fechaInicio,
		i.area,
		i.usuario,
		i.estado_Propuesta
	    FROM iniciativa as i, usuario as u
		WHERE i.usuario = u.correo and i.usuario = #{correo};
    </select>
  
  
  <select id="consultarPropuestaPorArea" resultMap="IniciativaResult" parameterType="map">
		SELECT 
	    i.nombrePropuesta,
		i.descripcion,
		i.fechaInicio,
		i.area,
		i.usuario,
		i.estado_Propuesta
	    FROM iniciativa as i, usuario as u
		WHERE i.usuario = u.correo and i.area = #{area};
    </select>
    
    <select id="agruparPropuestaPorArea" resultMap="IniciativaResult" parameterType="map">
		SELECT area, count(nombrePropuesta) FROM iniciativa
 		GROUP BY area;
    </select>
  
	
</mapper>
